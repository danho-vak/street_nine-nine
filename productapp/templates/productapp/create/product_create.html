{% extends 'base.html' %}

{% block content %}
<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <table>
        <tr>
            <th>
                <label for="product_category_container">Product category:</label>
            </th>
            <td>
                <div id="product_category_container">
                    <select id="large_category">
                        <option value="">선택 없음</option>
                    </select>

                    <select id="medium_category">
                        <option value="">선택 없음</option>
                    </select>

                    <select id="small_category">
                        <option value="">선택 없음</option>
                    </select>
                </div>
            </td>
            <td>
                <button class="btn btn-primary btn-sm">카테고리 추가하기</button>
            </td>
        </tr>
        <tr>
        </tr>
        <tr>
            <td>
                {{ forms.ProductCreationForm.as_table }}
                {{ forms.ProductThumbnailCreationForm.as_table }}
                {{ forms.ProductDetailImageCreationForm.as_table }}
            </td>
            <td>
                <input type="hidden" name="category_parent" id="category_parent" value="">
                <input type="hidden" name="category_name" id="category_name" value="">
                <input class="btn btn-primary" type="submit" value="등록">
            </td>
        </tr>
    </table>
</form>

<script>
    $('#large_category').change(function(){  // 대->중 카테고리 이벤트 등록
        medium_categories = data.filter(obj => obj.category_parent_id == this.value);
        $('#medium_category').empty().append('<option value="">선택 없음</option>');
        set_category(medium_categories, 'medium_category');
    });

    $('#medium_category').change(function(){  // 중->소 카테고리 이벤트 등록
        small_categories = data.filter(obj => obj.category_parent_id == this.value);
        $('#small_category').empty().append('<option value="">선택 없음</option>');
        set_category(small_categories, 'small_category');
    });

    $('#small_category').change(function(){
        category_name = $('#small_category').find(':selected').text();
        $('#category_parent').val(this.value);
        $('#category_name').val(category_name);
    });

    data = {{ category_list | safe }};

    set_category(data.filter(obj => obj.category_parent_id == null), 'large_category'); // 대분류 카테고리 설정

    function set_category(data, target_object){

        for (var i=0; i<data.length; i++){
            $('#'+target_object).append('<option value='+data[i].id+'>'+data[i].category_name+'</option>');
        }
    }
</script>
{% endblock %}